---
title: "Role of sociodemographic factors in the French cinema landscape over the last 50 years "
author: "Kylian SANTOS and Cédric BAZILE"
format: html
editor: visual
execute :
  echo: FALSE
  warning: FALSE
---

<br>

<center>

### Github link

</center>

<center><https://github.com/KylianSts/CNC_INSEE_project></center>

<br>

```{r Configuration, message=FALSE}
here::i_am("CNC_INSEE_project.Rproj")
library(here)
library(dplyr)
library(tidyr)
library(readxl)
library(ggplot2)

library(scales)#scales will be used to coerce R to present our data as number and not in scientific writing. I will also allow us later to put data in a percent format

library(plotly) #plotly will allow us to create interactive graph
```

# A presentation of the project

## Sources

This project is powered by two databases :

-   CNC's "**Exploitation - data by department**" : <https://www.cnc.fr/cinema/etudes-et-rapports/exploitation--donnees-par-departement_223440>

-   INSEE's "***Harmonized population census data from 1968***" : <https://www.insee.fr/fr/statistiques/6671801?sommaire=2414232>

<br>

### "***Exploitation - data by department***"

*Original french name : "**Exploitation - données par département**"*

The first database was created by the French National Center for Cinema and the Moving Image, most commonly known as CNC. The CNC is an agency of the French Ministry of Culture. Its role is to implement the state's policy on the question of cinema, audiovisual and multimedia. It is notably in charge of the regulation, promotion and distribution of French movies.

In the execution of its mission, the French agency also collects data regarding its purview and proposes part of them in open access. The database "Exploitation - data by department" is one of the aforementioned open data. It is a statistical monitoring of the evolution of French cinema theaters and their attendance between 1966 and 2022. Notably, it contains data on the number of venues, their characteristics (e.g. number of screens, seating capacity, ...); but also on the number of sold tickets and gained revenues. As its name indicates, French departments (according to their 2021 administrative division) are the statistical unit of the data. The CNC's data is constructed by using two primary sources :

-   the **list of cinemas** authorized by the agency

-   and their "bordereaux des recettes" which can be roughly translated by "**revenue slips**"

<br>

### "***Harmonized population census data from 1968***"

*Original title : Données harmonisées des recensements de la population à partir de 1968*

The second database was produced by Insee, the french National Institute of Statistics and Economic Studies. Insee is French national bureau and one of its major data providers. The data that will be used for this project has for source demographic information which comes from the different population censuses between 1968 and 2019.

```{r Summary_of_the_last_census, message = FALSE}
list_of_census <- data.frame(census = paste0("n°", 1:8),year=c(1968,1975,1982,1990,1999,2008,2013,2019))

list_of_census<- list_of_census |>  pivot_wider(names_from="census",values_from = "year")

list_of_census |> knitr::kable(caption ="French census between 1968 and 2019", format="html", align='c')
```

Censuses are one of the most important data collections taking place in France. Answering their survey is an obligation for all inhabitants under penalty of a fine (article 3 of the Law n°51-711 of 7 June 1951). Historically, population censuses took the form of an exhaustive collect of all French townships during a same year. However, the collection method evolved in 2002. Nowadays, Insee uses a rotational approach. For townships of at least 10 000 inhabitants, 8% of the housing of are interviewed each year. The goal is then to cover 40% of their population over a 5-year period. This 5-year moving sample is then used to estimate demographic data annually. For townships with less than 10 000 inhabitants, the collection is still exhaustive but is not simultaneous. Indeed, it occurs in a fifth of towns each year ensuring that all townships are censused every 5 years. Demographic information between 2 collections is then estimated using data from the nearest one.

The data is collected by face-to-face interviews or-since 2015- via internet surveys.

The database that will be used in this project is an harmonized compilation of data from 8 census databases. Its content includes the number of inhabitants by department and key socio-demographic variables (e.g. age, socio-professional categories, type of professional activity).

It can be downloaded from the [INSEE website](https://www.insee.fr/fr/statistiques/6671801?sommaire=2414232) in a DBF or CSV format.

<br>

## Modification of the original databases

### Formatting and cleaning the Insee database

The two databases underwent transformations to become exploitable for our project. The main problem of the Insee one is that it consumes a lot of RAM because of its size (3GB). Indeed, some categorical variables have a significant number of "categories"/"levels". For example, the variable on the age of the population contains 120 levels, one by each possible year of life of an individual. As a result, the number of potential combinations, and therefore the number of rows, among all variables is impressively large, contributing to the important size of the database.

```{r Calculation_of_the_number_of_rows_in_Insee_cleanv3 , message = FALSE}

insee_data <- read.csv("Data/INSEE_cleanv3.csv")

insee_data <- insee_data |> select(-X) #we drop X, the column which is an index of each row

insee_data <- insee_data |> filter(nchar(DEP_RES_21) != 3) #We drop oversea department

insee_data <- insee_data |> rename(departement_code = DEP_RES_21, year =  AN_RECENS)

insee_data_clean <- insee_data |> filter(!is.na(AGE_GROUP))

In_nrow <- insee_data_clean |> nrow()
```

Our task was to reduce the number of these combinations in order to downsize the database. To do so, we transform the 120 levels of the variable corresponding to the age into 5 age ranges. Furthermore, we get rid of the variables that were not useful to our project using a group_by function. This allows us to go from a database of more than 50 millions rows to a CSV with `r In_nrow` rows.

The process that we used is detailed in the quarto document entitled "Parallel_code_Insee" that is available in this R project. We have preferred to put it in a separate QMD because of the size of the database linked with its code.

<br>

### Formatting and cleaning of the CNC database

The CNC's data was less memory-consuming. However, its format was not convenient for coding with R. Indeed, the original XSLX document put each variable in an independent sheet. In the codes below, we merge all this independent sheets into one uniform database.

```{r Cleaning_formating_function, message = FALSE}
file_path <- "Data/exploitation_données_par_département.xlsx"

# Function to read and process a sheet
read_and_process_sheet <- function(sheet_index) {
  cnc_data <- read_excel(file_path, sheet = sheet_index, skip = 5) |>
    select(-2) |>
    rename(departement_code = 1) |>
    pivot_longer(cols = -departement_code, 
                 names_to = "year", 
                 values_to = excel_sheets(file_path)[sheet_index])
  
  return(cnc_data)
}
```

```{r Cleaning_CNC_database, message = FALSE}

cnc_data_merge <- read_and_process_sheet(4)

for (i in seq(from = 5, to = which(excel_sheets(file_path) == "tmofAE"))) {
  cnc_data_merge <- left_join(cnc_data_merge, read_and_process_sheet(i),
                              by = c("departement_code", "year"))
}
```

As mentioned above, the original XSLX file has multiple sheets. Each sheet is equivalent to a variable and has :

-   rows as departements

-   and columns as years.

To facilitate the merger of each sheets, the initial step was to rename the first column so that we make sure that each sheet shares the same name. This task was performed by the codes above. Then, the second column which is the department was dropped. It permit us to start the merger.

```{r Suppression_of_total_rows, message = FALSE}
cnc_data_clean <- cnc_data_merge |>
  filter(!is.na(departement_code))
```

Additionally, each sheet includes a row which represents the total. We preferred to exclude it in order to simplify next statistical treatment.

```{r replace_NA_by_0_multiplexes, message = FALSE}
multiplexes_with_0 <- cnc_data_clean |> 
  select(multiplexes, year, departement_code) |> 
  pivot_wider(names_from = year, values_from = multiplexes) |> 
  mutate(across(where(~any(!is.na(.))), ~ifelse(is.na(.), 0, .))) |> 
  pivot_longer(cols = -departement_code, names_to = "year", values_to = "multiplexes")

cnc_data_clean <- cnc_data_clean |> select(-multiplexes) 
  
cnc_data_clean <- left_join(cnc_data_clean, multiplexes_with_0, by = c("departement_code", "year"))
```

In the original "Multiplexes" sheet, NA value were assigned when there were 0 multiplexes. We replaced this NA value with 0. and ensured that this replacement only occurs for the year when data had been collected.

```{r Dropped_redundant_variables}
rme <- cnc_data_clean |> select(departement_code, year, RME)
rmeAE <- cnc_data_clean |> select(departement_code, year, RMEAE)
tmof <- cnc_data_clean |> select(departement_code, year, `taux d'occupation des fauteuils`)
tmofAE <- cnc_data_clean |> select(departement_code, year, tmofAE)

cnc_data_clean <- cnc_data_clean |> select(-`indice de fréquentation`, 
                                           -`indice de fréquentationAE`, 
                                           -RME, 
                                           -RMEAE,
                                           -`taux d'occupation des fauteuils`,
                                           -tmofAE)
```

We exclude redundant variables from the final, cleaned database and retain them in separate variables. This ensures that the excluded variables are preserved for future reference, eliminating the need to recalculate them later on.

<br>

## Description of the final bases before merging

The final result is two modified datasets.

**cnc_data_clean**

```{r size_CNC}
cnc_data_clean %>%
  summarize(
      "Number of rows" = prettyNum(nrow(.), big.mark = " "),  
      "Number of columns" = ncol(.)
      ) %>%
  
  knitr::kable(caption = "Description of the CNC database", 
               format = "html", 
               align = 'c')
```

```{r summary_CNC}
cnc_data_clean %>% 
  group_by(year) %>% 
  summarize(
    across(where(is.numeric),list(
      Mean = ~prettyNum(mean(., na.rm = TRUE), big.mark = " "),
      Median = ~prettyNum(median(., na.rm = TRUE), big.mark = " ")
    ))
    ) %>% 
  t() %>%
  knitr::kable(caption = "Statistics of the CNC's variables", format = "html", align = 'c')
```

**insee_data (from Insee_cleanv3.csv)**

```{r Nb_rows_and_columns_Insee}
insee_data_clean %>%
  summarize(
    "Number of rows" = prettyNum(nrow(.), big.mark = " "),
    "Number of columns" = ncol(.)
    )%>%
  
 knitr::kable(caption = "Description of the Insee database", format = "html", align='c')
```

```{r summary_INSEE}
insee_data_clean %>%
  select(-POND2) %>%
  summarize(across(everything(),n_distinct)) %>% 
  t() %>% 
  knitr::kable(caption = "Number of unique values/levels by characteristics variable", format = "html", align = 'c')
```

<br>

### Description of the variables

We have in the CNC database different variables :

-   "**établissement**" represents the **number of movie theaters** for each department
-   "**écrans**" represents the **number of screens,** i.e. movie rooms for each department
-   "**fauteuils**" represents the total **number of seats** in all movie theaters for each department
-   "**multiplexes**" represents the **number of** **multiplexes** for each department . A multiplex is a movie theater complex with multiple screens within a single complex.
-   "**séances**" represents the total **number of seances [in thousand]{.underline}** for each department
-   "**entrées**" represents the total **number of tickets bought [in million]{.underline}** for each department
-   "**recettes**" represents the **total** **revenue in million** for each department
-   "**RME**" represents the **average revenue by bought tickets**
-   "**Taux d'occupation des fauteuils**" is the ratio between **entries during the year and the product between the number of seats and the number of sessions**. Taux d'occupation des fauteuils makes it possible to assess the [**"fullness" of the rooms.**]{.underline}

And we have the same for Arthouse. the term Arthouse refers to so-called auteur films, economically independent, with small budgets, open to the different cultures of the world. An Arthouse cinema is a cinematographic establishment which exhibits a significant proportion of recommended Arthouse films and which supports these often difficult films with an adapted animation policy.

Insee database is a sociodemographic description of each department with variables such as :

-   "**DEP_RES_21**" represents the **department of residence where individuals live**
-   "**AGE_GROUP**" is our computed data representing the **age of the population by range of 15 years**.
-   "**TYP_ACT**" give us the **type of activity** .
-   "**CSP**" is a categorial data that has for levels **socio-professional category**
-   "**POND2**" gives us **the number of** **inhabitants** a**ccording the combination of all previous variables**

<br>

## Merging the INSEE and CNC database

```{r merging}
cnc_data_clean$year <- as.integer(cnc_data_clean$year) 

data_merge <- left_join(cnc_data_clean, insee_data, by = c("departement_code", "year"))

data_clean <- data_merge |>
  filter(!is.na(POND2))
```

<br>

## Research question

A central question will guide our research : **"How has the movie theater landscape in France evolved over the past five decades, and what role have sociodemographic factors played in shaping these transformations?"**

The databases at our disposal will help us to explore this question by looking into the following key aspects:

1.  **Evolution of the Market :** The information provided will help us understand how the movie theater market has evolved in terms of volumes over the last fifty years. One of the key aspects in exploring this question will be to examine the market evolution in terms of venues (établissements). However, the number of movie theaters will not be our sole indicator. Indeed, the number of sessions (séances), seats (fauteuils), and screens (écrans) will be complementary variables that can help us to put under the spotlight potential trends that may not be apparent when solely examining the number of venues. Employing panel data has a dual utility here. It not only enables us to capture the overall temporal trends but also to observe potential cross-sectional differences. Indeed, one of our key objectives is to comprehend whether divergences in trajectories and characteristics exist among the various French departments.

2.  **Structural Shifts with Multiplexes:** A zoom on the multiplexes permits evaluating a recent structural transformation in the movie theater industry. The first one appears in France during the end of the 1990s and can be arguably seen as a shift in the cinema market. Blanchard ([2014](https://www.cairn.info/revue-migrations-societe-2014-1-page-153.htm)) argues that these facilities "have contributed to the resurgence of attendance, notably by making the cinema more accessible to suburban residents." Furthermore, despite their relative novelty, they represent an important share of the market industry.

3.  **Economic Health of the Industry:** Variables such as the number of tickets bought (entrées) and total revenue (recettes) will also be complementary and potentially important information. They will notably be key tools for gauging the economic vitality of the industry and determining if the economic dynamics align with the stock of venues, seats, and their past investments.

4.  **Cultural Diversity through Arthouse Cinemas:** The representation of Arthouse cinemas in our dataset highlights the emergence of a cultural niche. Examining the growth and audience engagement of these cinemas provides insights into the supply and demand for culturally diverse content.

5.  **Demographic Dynamics :** The inclusion of variables from the INSEE database is a key step in our investigation. Utilizing information on age groups (AGE_GROUP) and socio-professional categories (CSP) will enable us to discern whether correlations exist between the demographic composition of the population and the trajectories of distinct departmental markets.

In essence, our research delves into the recent history of movie theaters in France in order to explore the connection between their evolution and sociodemographic factors, while taking into account departmental heterogeneity.

<br>

\newpage

# Evolution of the cinema market in time : a description of the major trend

## Introduction : the "golden age" of the first half of the 20th century

The history of the movie theater market unfolds on a winter day. In December 28th 1895, two brothers August and Louis Lumiere gave the first commercial public screening. Because a good history is full of happy coincidences, it is in France, at the Salon Indien du Grand Café in Paris that the two brothers used their *cinématographe*.

![](Pictures%20and%20illustrations/cinema-lumiere.jpg){fig-align="center"}

The movie theaters market experienced fast growth. According to Muhlberger (2013), in 1920s, cinema became a mass leisure activity in France but also in the USA and numerous European countries. In the Hexagon, cinema market fully blossomed a decade later. The period between 1929 and 1957 is often described as a golden age for cinema in France. Movie theaters attendance reached its zenith, with peaks beyond 400 millions entries. In a report for the French Senate, Thiolliere and Ralite (2003) link this fast period with the introduction of talking films.

<br>

The importance of cinema during this period maybe undestimated by our contemporary eyes. However, the two senatorial rapporteur explain that :

"We forget too often \[...\] that until the advent of the 'petite lucarne' (i.e. television) in households, cinema had a monopoly on the broadcasting of images. People frequented the theater, not to see a film, but rather to watch a program consisting of one or more short films, news, the trailer for the next film and, after the intermission and advertising, of the 'feature film'."

<center>*THIOLLIERE Michel & RALITE Jack au nom de la Commission des affaires culturelles du Sénat, 2003.* L'évolution du secteur de l'exploitation cinématographique, Rapport d'information sénatoriale n°308 (2002-2003)</center>

<br>

Nevertheless, as in many stories, the golden age is not eternal. Ours knew its dawn in 1957. Attendance collapsed. It more than halved between 1957 and 1966. The arrival of television is often cited as not the sole but a pivotal factor in this decline, which we will see will continue during most of the 20th century.

<br>

## Evolution of cinema in France from 1966 to 2018 : a global perspective

<br>

### "Act 1, Scene 1" - The decline continues

#### Evolution of the attendance between 1966 and 1992

```{r Aggregate_of_attendance_by_year}
Attendance_nat <- cnc_data_clean %>% 
  group_by(year) %>% 
  summarize(Attendance = sum(entrées, na.rm = TRUE)) %>% 
  mutate(Growth = (Attendance -lag(Attendance))/lag(Attendance)*100)

Attendance_AE_nat <- cnc_data_clean %>% 
  group_by(year) %>% 
  filter(!is.na(entréesAE)) %>%
  summarize(Attendance = sum(entréesAE, na.rm = TRUE)) %>% 
  mutate(Growth = (Attendance -lag(Attendance))/lag(Attendance)*100)
```

```{r calculation_of_growth_rates}
#Calculation of the growth rate between 1966 and 1992

Growth_rate_1966_1992 <- Attendance_nat %>%
  filter(year %in% c(1966, 1992)) %>%  
  select(-Growth)

Growth_rate_1966_1992 <-Growth_rate_1966_1992 %>% 
  reframe(Growth=(Attendance-lag(Attendance))/lag(Attendance)*100) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth) %>% 
  round(.,digits = 2)

#Calculation of the average growth rate between 1966 and 1992

nrow_1966_1992 <-
  Attendance_nat %>% 
  filter(year<1993) %>% 
  nrow()

Av_Growth_rate_1966_1992 <- Attendance_nat %>% 
  filter(year %in% c(1966,1992)) %>% 
  select(-Growth) %>% 
  mutate(Growth = ((Attendance / lag(Attendance))^(1/nrow_1966_1992) - 1) * 100) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth) %>%
  round(., digits=1)

#Calculation of the growth rate between 1966 and 1969

Growth_rate_1966_1969 <- Attendance_nat %>%
  filter(year %in% c(1966, 1969)) %>%  
  select(-Growth)

Growth_rate_1966_1969 <-Growth_rate_1966_1969 %>% 
  reframe(Growth=(Attendance-lag(Attendance))/lag(Attendance)*100) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth) %>% 
  round(.,digits = 2)

#Calculation of the growth rate between 1982 and 1992

Growth_rate_1982_1992 <- Attendance_nat %>%
  filter(year %in% c(1982, 1992)) %>%  
  select(-Growth)

Growth_rate_1982_1992 <-Growth_rate_1982_1992 %>% 
  reframe(Growth=(Attendance-lag(Attendance))/lag(Attendance)*100) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth) %>% 
  round(.,digits = 2)
```

```{r Statistics_on_multiplexes}
Multiplex_nat <- cnc_data_clean %>% 
  filter(year >= 1992) %>% 
  group_by(year) %>% 
  summarize(
    nb_multiplex = sum(multiplexes, na.rm = TRUE), 
    nb_etablissement = sum(établissements, na.rm = TRUE),
    share_multiplexe = (nb_multiplex /nb_etablissement)*100,
    nb_etablissements_no_m = nb_etablissement-nb_multiplex
            )

Etablissement_AE <- cnc_data_clean %>% 
  group_by(year) %>% 
  filter(!is.na(étabAE)) %>%
  summarize(nb_etablissement_AE = sum(étabAE, na.rm = TRUE))
```

```{r Statistics_on_recettes}
recette_nat <- cnc_data_clean %>% 
  group_by(year) %>% 
  summarize(recette_tot = sum(recettes, na.rm = TRUE))

recette_AE_nat <- cnc_data_clean %>% 
  group_by(year) %>% 
  filter(!is.na(recettesAE)) %>%
  summarize(recetteAE_tot = sum(recettesAE, na.rm = TRUE))
```

```{r}
inflation_fr <- read.csv("Data/valeurs_annuelles.csv", sep=";", skip = 3) %>%
  select(-3) %>%
  rename(year=1, coef_ratio=2) %>%
  filter(year > 1965 & year < 2023) %>%
  mutate(coef_ratio = 100/coef_ratio)

recettes_without_inflation <- cnc_data_clean %>%
  select(year, recettes, recettesAE) %>%
  left_join(inflation_fr, by = "year") %>%
  mutate(
    recettes = recettes * coef_ratio,
    recettesAE = recettesAE * coef_ratio
  )
```

```{r}
recette_nat_without_inf <-recettes_without_inflation %>% 
  group_by(year) %>% 
  summarize(recette_tot = sum(recettes, na.rm = TRUE)) %>%
  mutate(rme_nat_without_inflation = recette_tot/Attendance_nat$Attendance 
)
```

Our analytic journey starts in 1966, which is the first availabe year in our used database. The CNC's data shows that trend that was observed between 1957 and 1966 continued over the next 26 years. Indeed, between 1966 and 1992, attendance was halved (`r Growth_rate_1966_1992` % with an average growth rate of `r Av_Growth_rate_1966_1992` % during the period). The movie theater market experienced especially two periods of sharp decline. Firstly, from1966 to 1969 attendance droped by `r abs(Growth_rate_1966_1969)` %. During this period, movie theaters witnessed 234 millions of entries in 1966 but only 183 millions in 1969. Similarly, in the decade spanning from1982 and 1992, attendance fell from 201 million to 115 million felt, representing a `r abs(Growth_rate_1982_1992)` % decrease.

```{r}
#Graphic of the evolution of attendance in time

Att_graph1 <- Attendance_nat %>% 
  filter(year < 1993) %>% 
  ggplot(aes(x = year, y = Attendance)) +
  geom_line(color="orange") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Attendance in France by year [1966-1992] - Dynamic graph", x="Year", y="Attendance")+
  theme_minimal()

ggplotly(Att_graph1)
```

<br>

18 of the 26 years between 1966 (not included) and 1992 (included) are thus characterized by a negative attendance's growth rate.The causes of this degrowth are multifactorial. The democratisation of television and of automobile are however presented as one of the the key factors of this decay.

```{r}
#Graphic of the Growth by year

Att_graph2 <-Attendance_nat %>% 
  filter(year < 1993 & year>1966) %>% 
  mutate(Growth_rate=ifelse(Growth<0, "Negative", "Positive")) %>% 
  ggplot(aes(x = year, y = Growth, fill=Growth_rate)) +
  geom_col() +
  scale_fill_manual(values = c("lightblue", "orange")) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) + 
  labs(title = "Growth rate by year [1967-1992]", x="Year", y="Growth rate by year", fill="Growth rate") +
  theme_minimal()

ggplotly(Att_graph2)
```

```{r}
Re_graph1 <- recette_nat %>% 
  filter(year < 1993) %>% 
  ggplot(aes(x = year, y = recette_tot)) +
  geom_line(color="skyblue") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Recette in France by year [1966-1992] - Dynamic graph", x="Year", y="Recette Totale")+
  theme_minimal()

ggplotly(Re_graph1)


Re_graph2 <- recette_nat_without_inf %>% 
  filter(year < 1993) %>% 
  ggplot(aes(x = year, y = recette_tot)) +
  geom_line(color="skyblue") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Recette in France by year [1966-1992] in 2015€ - Dynamic graph", x="Year", y="Recette Totale")+
  theme_minimal()

ggplotly(Re_graph2)
```

```{r}
Re_graph2 <- recette_nat_without_inf %>% 
  filter(year < 1993) %>% 
  ggplot(aes(x = year, y = rme_nat_without_inflation)) +
  geom_line(color="skyblue") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Average revenue by entry in France by year [1966-1992] in 2015€ - Dynamic graph", x="Year", y="Recette Totale")+
  theme_minimal()

ggplotly(Re_graph2)
```

<br>

even if attendance decreases, money earned by movie theater increase. due to ...

#### Evolution of the structure of the market

The number of seats strongly declined during this period. As we can see on the graphic below, while the Hexagon welcomed 2,4 million of cinema seats in 1966, only 93 000 seats characetrized the French market in 1992.

```{r statistics_on_seats_and_screens}
Equip_nat <- cnc_data_clean %>% 
  group_by(year) %>% 
  summarize(Screens = sum(écrans, na.rm = TRUE),
            Seats = sum(fauteuils, na.rm=TRUE),
            Seats_by_screens = Seats/Screens)

Equip_AE_nat <- cnc_data_clean %>% 
  group_by(year) %>% 
  filter(!is.na(écransAE)) %>%
  summarize(Screens_AE = sum(écransAE, na.rm = TRUE),
            Seats_AE = sum(fauteuilsAE, na.rm=TRUE))
```

```{r}
#Evolution of the number of Seats

Se_graph1 <- Equip_nat %>% 
  filter(year<1993) %>% 
  ggplot(aes(x=year, y=Seats)) +
  geom_line(color="brown")+
  labs(title = "Number of Seats in France", x="Year", y="Number of Seats")+
  theme_minimal()

ggplotly(Se_graph1)
```

<br>

Data on the number of cinemas is not available on our database before 1992. However, we have for hypothesis that a part of this decline is due to the foreclosure of movie theaters. Nevertheless, this hypothesis is not sufficient to understand the evolution of the number of seats during this quarter of century.

Indeed, what can be surprising is that, at the same time that the number of seats diminished, the number of screens had a different journey.

Until 1971, the number of seats and screens followed the same downward trajectory. However, while the number of seats plundered, the number of screens tended to stabilize then to grow between 1972 and 1985. The graphic below highlights these elements. By using a 1966 base index 100 for both variables, we can focus on their evolution, putting aside the scale effect. The index of the number of seats almost halved from 1972 to 1985. In parallel the index of the number of screens is more than 20 points higher in 1985 than what was observed in 1972. It is even 5 points higher than the index in 1966. Despite the fact that the number of screens experienced a period of degrowth between 1986 and 1992, a serious gap exists between the two indexes in 1992.

```{r}
#Addition of base index 100 variable
Equip_nat <- Equip_nat %>%  mutate(Screens_b100=Screens/Screens[year==1966]*100, Seats_b100=Seats/Seats[year==1966]*100)


#Comparaison the number of seats and screens
 ## Pivot
 Equip_nat_b100 <- Equip_nat %>% 
   select(year,Screens_b100,Seats_b100) %>% 
   pivot_longer(cols = c(Screens_b100,Seats_b100),names_to = "Variables", values_to =  "Base_index_100")
 
 ##Graphic
 Se_Sc_graph1 <- Equip_nat_b100 %>% 
   filter(year<1993) %>% 
  ggplot(aes(x=year, y=Base_index_100, color=Variables)) +
  geom_line() +
  scale_color_manual(values = c("red", "brown")) +
  labs(title = "Comparaison of the number of seats and screens (base index 100 in 1966)", x="Year", y="Number of seats")+
  theme_minimal()

ggplotly(Se_Sc_graph1)
```

<br>

How can we comprehend these contradictory trends? Thiolliere and Ralite (2003) explained that this paradox can be explained by a structural change of the movie theater market. Prior to the late 60s, a large portion of the cinema market was dominated by single-screen movie halls with a substantial number of seats. Everything changed after the 60s. The second half of the 21st century witnessed a shift from one-room movie halls to halls with fewer seats but a plural number of screens. Thus, some former one-room cinemas repurposed their spaces to welcome more screens, and multiroom setups became predominant among newly constructed cinemas. Thiolliere and Ralite assert that this new structure enabled the industry to intensify its exploitation capabilities in order to offer more choices for its consumers. These new cinemas had better performance than their one-room elders, explaining the latter's gradual disappearance. This shift can be observed in the ratio of chairs to screens, which can be interpreted as an indicator of the size of the screening room in terms of seats.

```{r}
Se_Sc_graph2 <- Equip_nat %>%
  filter(year<1993) %>% 
  ggplot(aes(x=year,y=Seats_by_screens))+
  geom_line(color = "gold")+
  labs(title = "Ratio of Seats by Screens in France by Year", x="Year", y="Seats by Screen")+
  theme_minimal()

ggplotly(Se_Sc_graph2)
```

<br>

### "Act 2" - The resurgence

#### Evolution of the attendance

```{r calculation_growth_rates}
#Calculation of the growth rate between 1993 and 2018

Growth_rate_1993_2018 <- Attendance_nat %>%
  filter(year %in% c(1993, 2018)) %>%
  reframe(Growth=(Attendance-lag(Attendance))/lag(Attendance)*100) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth) %>% 
  round(.,digits = 2)

#Calculation of the average growth rate between 1966 and 1992

nrow_1993_2018 <- Attendance_nat %>% 
  filter(year>1992 & year<2019) %>% 
  nrow()

Av_Growth_rate_1993_2018 <- Attendance_nat %>% 
  filter(year %in% c(1993,2018)) %>% 
  select(-Growth) %>% 
  mutate(Growth = ((Attendance / lag(Attendance))^(1/nrow_1993_2018) - 1) * 100) %>% 
  filter(!is.na(Growth))  %>% 
  pull(Growth) %>%
  round(., digits=1)
```

In many movies, after a tragic downfall, the hero comeback in a flamboyant manner.If this storyline mark movies in theater, it also echoes the history of the industry. The 25 years between 1993 and 2018 are a period of growth for the cinema's market. The attendance went from 130 million to suprass the symbolic bar of the 200 million. If this level is still lower thanwhat was observed during the "golden age", the upturn is still significant with agrowth of `r Growth_rate_1993_2018` % during the period and an average growth of `r Av_Growth_rate_1993_2018` % by year.

```{r}
Att_graph3 <- Attendance_nat %>% 
  filter(year >1992 & year<2019) %>% 
  ggplot(aes(x = year, y = Attendance)) +
  geom_line(color="orange") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Attendance in France by year [1993-2018]", x="Year", y="Attendance")+
  theme_minimal()

ggplotly(Att_graph3)
```

<br>

```{r}
Att_graph4 <-Attendance_nat %>% 
  filter(year >1992 & year<2019) %>% 
  mutate(Growth_rate=ifelse(Growth<0, "Negative", "Positive")) %>% 
  ggplot(aes(x = year, y = Growth, fill=Growth_rate)) +
  geom_col() +
  scale_fill_manual(values = c("lightblue", "orange")) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) + 
  labs(title = "Growth rate by year [1993-2018]", x="Year", y="Growth rate by year", fill="Growth rate") +
  theme_minimal()

ggplotly(Att_graph4)
```

Numerous scientific papers and reports agree that this revival is due to the development of multiplexes (Blanchard, 2014 ; CNC, 2013; Muhlberger, 2013; Thiolliere and Ralite, 2003). Theses structures would have sparked again the interest of the consumers for movie theaters.

<br>

#### Evolution of the structure of the market

Several concurrent definitions exist for the term 'multiplex.' A broad one can characterize multiplexes as movie halls with a large number of screens. Nevertheless, Blanchard (2014) argues that multiplexes cannot be solely summarized by the number of screens. He highlights that multiplexes also offer a better quality of the consumers' experience, with enhanced overall comfort in the screening room and access to additional services such as arcades or restaurants. According to this definition, the first multiplex opened in France in Toulon in 1993. The CNC (National Center of Cinematography and the Moving Image) uses a simpler definition to establish its statistics. It describes multiplexes as movie theaters with at least 8 screens - with this definition, 31 movie theaters met the multiplex criteria in 1992. Despite these differing definitions, both the CNC and Blanchard draw the same conclusion about the significant impact of multiplexes on the market upturn.

The last three decades are indeed an era of sustained growth for multiplexes. Their numbers have multiplied by seven between 1993 and 2022.

```{r}
 M_graph1 <- Multiplex_nat %>% 
  filter(year >1992 & year<2019) %>% 
  ggplot(aes(x = year, y = nb_multiplex)) +
  geom_line(color = "navy") + 
   labs(titre="Number of multiplexes in France between 1993 and 2018", x="Year", y="Number of multiplexes")+
  theme_minimal()

ggplotly(M_graph1)
```

```{r}
Re_graph4 <- recette_nat_without_inf %>% 
  filter(year > 1992) %>% 
  ggplot(aes(x = year, y = rme_nat_without_inflation)) +
  geom_line(color="skyblue") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Average revenue by entry in France by year [1993-2022] in 2015€ - Dynamic graph", x="Year", y="Average Revenue")+
  theme_minimal()

ggplotly(Re_graph4)
```

<br>

Data on the number of cinemas were not available in the database prior to 1992. The existing data seem to reveal 3 phases :

-   a period of growth in the 90s

-   a decline in the number of cinemas between 2000 and 2014

-   and, a small revival between 2014 and 2018.

However, when observing the number of cinemas, multiplexes excluded, a different story unfolds before our eyes. The graph below shows the evolution of the number of cinemas, both with and without multiplexes. It appears that multiplexes accounted for most of the growth in the 1990s. Moreover, the number of cinemas has plummeted since 2000 when multiplexes are excluded from the count. Nevertheless, it is important to note that our analysis is limited by an element whose significance remains uncertain. Our data do not allow us to distinguish between the outright closure of cinemas and the transformation of former multiroom cinemas into multiplexes.

```{r}
Et_graph <- Multiplex_nat %>% 
  rename ("All cinemas"=nb_etablissement, "Cinemas excluding multiplexes" = nb_etablissements_no_m) %>% 
  pivot_longer(cols = c(`All cinemas`, `Cinemas excluding multiplexes`),names_to = "Variables",values_to = "Nb") %>% 
  filter(year<2019) %>% 
  ggplot(aes(x=year,y=Nb, color=Variables)) +
  labs(title = "Number of cinemas in France between 1992 and 2018", x="Year", y="Number of cinemas")+
  geom_line()+
  theme_minimal()

ggplotly(Et_graph) 
  
#The rename function is used to change (only for the creation of this graphic) the name of the original column which became the values of the column"Variables". The goal behind this transformation is to have more significative name for the two curves in our legend. We also use the layout function to put the legend above the graph because plotly does not take into account theme(legend.position = "top") when it transform the ggplot.
```

<br>

The share of multiplexes in the total number of movie theaters also grew during this year, gaining 9.5 percentage points between 1993 and 2018. Furthermore, if multiplexes may still be a minority in the overall number of cinemas, this is not the case for the total number of attendance. They accounted for more than half of the entries in 2012 (Blanchard, 2014).

```{r}
M_graph2 <- Multiplex_nat %>% 
  filter(year >1992 & year<2019) %>% 
  ggplot(aes(x = year, y = share_multiplexe)) +
  geom_line(color="navy") +
  scale_y_continuous(labels = scales::percent_format(scale = 1))+ 
   labs(title="Share of the multiplexes in the total of movie theater between 1993 and 2018", x="Year", y="Percentage")+
  theme_minimal()

ggplotly(M_graph2)
```

<br>

The development of multiplexes coincides with a rise of the number of screens in the French territory.

```{r}
Sc_graph <- Equip_nat %>% 
  filter(year > 1992 & year < 2019) %>% 
  ggplot(aes(x = year, y = Screens)) +
  geom_line(color = "red") +
  labs(title = "Number of Screens in France between 1993 and 2018", x = "Year", y = "Number of Screens") +
  theme_minimal()

ggplotly(Sc_graph)
```

<br>

```{r}
Se_diff_rate_1993_2018 <- Equip_nat %>%
  filter(year %in% c(1993, 2018)) %>%  
  select(-Screens) %>% 
  reframe(Growth=(Seats-lag(Seats))) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth)

Se_diff_rate_1993_2018 <- format(Se_diff_rate_1993_2018, big.mark = " ") 

Se_Growth_rate_1993_2018 <- Equip_nat %>%
  filter(year %in% c(1993, 2018)) %>%  
  select(-Screens) %>% 
  reframe(Growth=(Seats-lag(Seats))/lag(Seats)*100) %>% 
  filter(!is.na(Growth)) %>% 
  pull(Growth) %>% 
  round(.,digits = 0)
```

The number of seats started also to grow again. This growth did not compensante the historical significant decline that marked the second haft of the 20th century - c.f. graph below on the 1962-2018 period. However, it is still highlysignificant regarding the level observed in 1993 -c.f. graph below on the 1993-2018 period. In total, the number of seats increased of `r Se_diff_rate_1993_2018` seats, representing an augmentation of `r Se_Growth_rate_1993_2018` %.

```{r}
#Evolution of the number of Seats
Se_graph2 <- Equip_nat %>% 
  filter(year<2019) %>% 
  ggplot(aes(x=year, y=Seats)) +
  geom_line(color="brown")+
  geom_vline(xintercept = 1993, linetype = "dashed", color = "pink")+
  labs(title = "Number of Seats in France between 1962 and 2018", x="Year", y="Number of Seats")+
  theme_minimal()

ggplotly(Se_graph2)

#Evolution of the number of Seats
Se_graph3 <- Equip_nat %>% 
  filter(year>1992 & year<2019) %>% 
  ggplot(aes(x=year, y=Seats)) +
  geom_line(color="brown")+
  labs(title = "Number of Seats in France between 1993 and 2018", x="Year", y="Number of Seats")+
  theme_minimal()

ggplotly(Se_graph3)
```

<br>

### Art et Essaie en hausse

```{r}
AE_graph1 <- Attendance_AE_nat %>% 
  ggplot(aes(x = year, y = Attendance)) +
  geom_line(color="orange") +
  scale_y_continuous(labels = scales::number_format())+ 
  labs(title ="Attendance AE in France", x="Year", y="Attendance")+
  theme_minimal()

ggplotly(AE_graph1)
```

```{r}
AE_graph <-Attendance_AE_nat %>% 
  filter(year < 2020 & year> 1966) %>%
  mutate(Growth_rate=ifelse(Growth<0, "Negative", "Positive")) %>% 
  ggplot(aes(x = year, y = Growth, fill=Growth_rate)) +
  geom_col() +
  scale_fill_manual(values = c("lightblue", "orange")) +
  scale_y_continuous(labels = scales::percent_format(scale = 1)) + 
  labs(title = "Growth rate by year [1993-2018]", x="Year", y="Growth rate by year", fill="Growth rate") +
  theme_minimal()

ggplotly(AE_graph)
```

```{r}
AE_graph2 <-  Etablissement_AE %>% 
  ggplot(aes(x = year, y = nb_etablissement_AE)) +
  geom_line(color = "orange") + 
  labs(titre="Number of movie thearter in France", x="Year", y="Number of movie thearter")+
  theme_minimal()

ggplotly(AE_graph2)
```

```{r}
AE_graph3 <-  recette_AE_nat %>% 
  ggplot(aes(x = year, y = recetteAE_tot)) +
  geom_line(color = "orange") + 
  labs(titre="Total recettes AE in France", x="Year", y="Total recettes")+
  theme_minimal()

ggplotly(AE_graph3)
```

```{r}
AE_graph4 <- Equip_AE_nat %>% 
  ggplot(aes(x=year, y=Seats_AE)) +
  geom_line(color="orange")+
  labs(title = "Number of Seats in AE in France", x="Year", y="Number of Seats")+
  theme_minimal()

ggplotly(AE_graph4)
```

```{r}
AE_graph5 <- Equip_AE_nat %>% 
  ggplot(aes(x=year, y=Screens_AE)) +
  geom_line(color="orange")+
  labs(title = "Number of Seats in AE in France", x="Year", y="Number of Seats")+
  theme_minimal()

ggplotly(AE_graph5)
```

## Test on how to make appear evolution by department

### Attendance

#### Valeur en base 100 1966

Observation : a global trend but also data shows that some department had a different trajectory (maybe a econometrics model can show if it is become of the department in itselfs or because its socio-demographic characteristics)

```{r}
Dep_attb100 <- cnc_data_clean %>%  
  group_by(departement_code) %>%
  select(year,entrées,departement_code) %>%
  mutate(Att_b100 = round(entrées / entrées[year == 1966] * 100, digits=0))

Dep_attb100_graph <- Dep_attb100 %>% 
  filter(year<2019) %>% 
  ggplot(aes(x=year, y=Att_b100, color=departement_code, group=departement_code)) +
  labs(title = "Attendance by departement base index 100 1966", x="Year",y="Attendance")+
  geom_line()+
  theme_minimal()

#group=department_code was necessary to R to display the different graph, a standard color= in ggplot(aes()) did not work
 
ggplotly(Dep_attb100_graph)
```

#### Découpage en période

```{r}
#1966-1992
Dep_attb100_graph_1962_1992 <- Dep_attb100 %>% filter(year<1993) %>% 
  ggplot(aes(x=year, y=Att_b100, color=departement_code, group=departement_code)) +
  labs(title = "Attendance by departement base index 100 1966[1966-1992]", x="Year",y="Attendance")+
  geom_line()+
  theme_minimal()
 
ggplotly(Dep_attb100_graph_1962_1992)

#1993-2018
Dep_attb100_graph_1993_2018 <- Dep_attb100 %>% 
  filter(year > 1992 & year <= 2018) %>% 
  ggplot(aes(x=year, y=Att_b100, color=departement_code, group=departement_code)) +
  labs(title = "Attendance by departement base index 100 1966 [1993-2018]", x="Year",y="Attendance")+
  geom_line()+
  theme_minimal()

ggplotly(Dep_attb100_graph_1993_2018)
```

#### Test : Show example of peculiar trajectory

Some departement seem to have known distinctive trajectories with explosive growth or stronger decline. We can cite for example emphasize the explosive growth of the 77 or the 40.

```{r}
#Addition of rows giving the base 100 at the national level
Attendance_nat_b100<- Attendance_nat %>% select(-Growth) %>% rename("entrées"=Attendance) %>% mutate(departement_code="France",Att_b100 = round(entrées / entrées[year == 1966] * 100, digits=0))

Dep_attb100 <-rbind(Dep_attb100, Attendance_nat_b100)

#Graphic of the base 100 for France and some department with peculiar trajectories

##1st graph

Dep_attb100_graph2 <- Dep_attb100 %>% 
  filter(year<2019) %>% 
  filter(departement_code  %in% c("France", "77", "40")) %>% 
  ggplot(aes(x=year, y=Att_b100, color=departement_code,group=departement_code))+
  geom_line(size=0.3)+
  geom_line(data = . %>% filter(departement_code == "France"), size = 1, color="navy") + 
  labs(title = "Example of departement with peculiar trajectory: Attendance (index base 100 1966) - 40 and 77", x="Year", y="Attendance")+
  theme_minimal()

ggplotly(Dep_attb100_graph2)
```

70 and 88 are them opposite example with their attendance that plummeted between 1966 and 1992. 92 knew the most violent that can be observed between 1966 and 1977 with an index that quartered before knowing a strong revival.

```{r}
#2nd Graph

Dep_attb100_graph3 <- Dep_attb100 %>% 
  filter(year<2019) %>% 
  filter(departement_code  %in% c("France", "70","92", "88")) %>% 
  ggplot(aes(x=year, y=Att_b100, color=departement_code,group=departement_code))+
  geom_line(size=0.3)+
  geom_line(data = . %>% filter(departement_code == "France"), size = 1, color="navy") + 
  labs(title = "Example of departement with peculiar trajectory : Attendance (index base 100 1966) - 78 and 92", x="Year", y="Attendance")+
  theme_minimal()

ggplotly(Dep_attb100_graph3)
```

#### ratio b100 France/departement

```{r}
#Goal : calculation of the ratio between the index of each departement and the equivalent for France (national level)
Attendance_nat_b100_v2 <- Attendance_nat_b100 %>% 
  rename(Fr_Att_b100=Att_b100) %>%
  select(year, Fr_Att_b100)

Dep_attb100 <- Dep_attb100 %>%
  left_join(Attendance_nat_b100_v2, by="year" ) 

Dep_attb100 <- Dep_attb100 %>%
  mutate(Att_b100_ratio = Att_b100/Fr_Att_b100)

Dep_attb100_graph_ratio <- Dep_attb100 %>% filter(year<2019) %>% 
  ggplot(aes(x=year, y=Att_b100_ratio, color=departement_code, group=departement_code)) +
  labs(title = "Attendance by departement base index 100 1966", x="Year",y="Attendance")+
  geom_line()+
  theme_minimal()

ggplotly(Dep_attb100_graph_ratio)
```

#### Maps for attendance

Relative hétérogénéité - Ecart au niveau de 1966 plus prononcé

-   de façon "Negative" (i.e. décroissance potentiel) : nord est plus touché par les phrases de décroissance

-   Positive : ile de france, ouest et sud est mais aussi certains départements du sud ouest

```{r}
#We will create an evolutive map to represent the evolution of the index base 100 1966 linked to attendance year after year. To do so, we will combine our statistical data with geographic information obtained from a shapefile downloaded from the IGN website. Then, we will generate several maps and convert them into a GIF that highlights the passage of time, showcasing the evolution of the index year after year. This code draws inspiration from various sources, with particular influence from  an oline book of  HAHN (2020) and the technical explanations in the 'tmap' package by TENNEKES et al. (2023).


#Import the shapefile data
library(sf) #We'll use sf to open shapefile, i.e. cartographic data
Dep_shp <- st_read(dsn = "Maps/ADMIN-EXPRESS/1_DONNEES_LIVRAISON_2023-12-00156/ADE_3-2_SHP_LAMB93_FXX-ED2023-12-19/DEPARTEMENT.shp", stringsAsFactors = FALSE, quiet = TRUE)

#Merge with CNC statistics

Dep_shp <- Dep_shp %>% 
   left_join(Dep_attb100, by = c("INSEE_DEP" = "departement_code"))%>% 
  filter(year %in% c(1966,1968,1972,1975,1979,1982,1985,1988,1990,1993,1996,1999,2002,2005,2008,2011,2013,2016,2019)) 

#Interactive Maps

library(tmap)
library(tmaptools)
#Note for Mister Rossy : if you do not have the tmap package, one of the document that we use as inspiration to create the interactive maps recommend to install tmap's development version from the r-universe repository : install.packages("tmap", repos = c("https://r-tmap.r-universe.dev", "https://cloud.r-project.org"))

tmap_mode("view")

chosen_breaks <- c(16, 48, 69, 100, 150, 200, 250, 300, Inf)
#After testing numerous ways to create classes for the following graph with the style option of tm_fill ("quantile", "pretty", "equal", "headtails") and values for the option n, we chose to define our own classes using the breaks option and style ="fixed". These new classes are inspired by, but diverge from, the values obtained with style="quantile" (while conducting parallel tests with n=) for values under 100. For values above 100, arbitrary classes were created to emphasize the divergence of trajectories of department with positive growth, which quantile had difficulty capturing due to the smaller sample of values above 100.".

Dep_shp_anim <- tm_shape(Dep_shp) +
  tm_fill(fill="Att_b100", style = "fixed", breaks=chosen_breaks, palette="-RdBu", midpoint=100) +
  tm_borders() +
  tm_facets(by = "year", nrow = 1, ncol = 1)+
  tm_compass(type="8star",position=c("right","top"),size=3,show.labels = 2)+
  tm_scalebar(position=c("left","bottom"))+
  tm_title_out(text ="Attendance by year and departement (index base 100 1966)",  position = tm_pos_out("center", "top") )

library(gifski)
tmap_animation(Dep_shp_anim, filename = "Dep_shp_anim2.gif", delay = 1)

library(magick)
Gif <- image_read("Dep_shp_anim2.gif")
image_animate(Gif,fps = 1)
#We use fps and the number of year in order to reduce the "pace" of the Gif.
```

# Evolution of type of population in France and their impact on cinema industry

```{r}
pop_dep <- insee_data_clean %>%
  group_by(departement_code, year) %>%
  summarise(population_dep = sum(POND2))

pop_fr <- insee_data_clean %>%
  group_by(year) %>%
  summarise(population_fr = sum(POND2))

pop_dep <- left_join(pop_dep,pop_fr, by= 'year') %>%
  mutate(per_pop_dep = population_dep/population_fr * 100)

base_year <- pop_dep %>%
  group_by(departement_code) %>%
  filter(year == 1990) %>%
  select(per_pop_dep, departement_code) %>%
  rename(base=per_pop_dep)

pop_dep <- left_join(pop_dep, base_year, by = "departement_code") %>%
  mutate(per_pop_dep_change = (per_pop_dep / base -1)*100)
```

```{r fig.width=12, fig.height=15}
#on regarde l'évolution temporelle de la part de la population de chaque département dans la population pour voir ou se concentre la population dans le temps

#remarque si on prend 1990 comme base, l'echelle de ce qui est avant est inversé. (j'ai fais ca pour comparer avec les établissement)

france_shape <- st_read(dsn = "Maps/ADMIN-EXPRESS/1_DONNEES_LIVRAISON_2023-12-00156/ADE_3-2_SHP_LAMB93_FXX-ED2023-12-19/DEPARTEMENT.shp", stringsAsFactors = FALSE, quiet = TRUE)

france_shape <- france_shape %>% rename(departement_code=INSEE_DEP)

merged_data <- merge(france_shape, pop_dep, by = "departement_code")

ggplot(merged_data, aes(fill = per_pop_dep_change)) +
  geom_sf() +
  scale_fill_viridis_c(option = "H") + 
  labs(title = "Population Map of France", fill = "per_pop_dep_change") +
  theme_minimal() +
  facet_wrap(~year, ncol = 2)
```

```{r fig.width=12, fig.height=15}
#"offre" cinema, on peut aussi mettre fauteuils à la place 
#Note a moi meme --> faire la meme avec la demande --> variable entrées 

etab_dep <- cnc_data_clean %>%
  group_by(departement_code, year) %>%
  summarise(etablissements_dep = sum(établissements)) %>%
  filter(!is.na(etablissements_dep))

etab_fr <- Multiplex_nat %>%
  select(year, nb_etablissement)

etab_dep <- left_join(etab_dep, etab_fr, by= 'year') %>%
  mutate(per_etab_dep = etablissements_dep/nb_etablissement * 100)%>%
  filter(year == 1992 | year == 1999 | year == 2008 | year == 2013 | year == 2019)

base_year <- etab_dep %>%
  group_by(departement_code) %>%
  filter(year == 1992) %>%
  select(per_etab_dep, departement_code) %>%
  rename(base=per_etab_dep)

etab_dep <- left_join(etab_dep, base_year, by = "departement_code") %>%
  mutate(per_etab_dep_change = (per_etab_dep / base -1)*100)
```

```{r fig.width=12, fig.height=15}
#Blablabla ... ou se concentre les cinémas dans le temps

france_shape <- st_read(dsn = "Maps/ADMIN-EXPRESS/1_DONNEES_LIVRAISON_2023-12-00156/ADE_3-2_SHP_LAMB93_FXX-ED2023-12-19/DEPARTEMENT.shp", stringsAsFactors = FALSE, quiet = TRUE)

france_shape <- france_shape %>% rename(departement_code=INSEE_DEP)

merged_data <- merge(france_shape, etab_dep, by = "departement_code")

ggplot(merged_data, aes(fill = per_etab_dep_change)) +
  geom_sf() +
  scale_fill_viridis_c(option = "H") + 
  labs(title = "Population Map of France", fill = "per_etab_dep_change") +
  theme_minimal() +
  facet_wrap(~year, ncol = 2)
```


```{r}
#Blabla ... ou se concentre les vieux dans le temps 
#on regarde que la population de vieux et on regarde l'évolution de la part de vieux dans le departement par rapport a la population de vieux 

#Note a moi meme --> mauvais raisonnement, ca reveint au meme qu ele premier graphique, ici ce n'ets pas une concentration de vieux mais toujours de population meme si un peu modifier par la vrai concentration de vieux 
#faire un graphique de nombre d'entrée moyen par vieux, par etudiant, employé ... 
# pour faire ca : prendre le nombre de vieux dans la pop et le nombre d'entrées et diviser.
pop_dep_old_now <- insee_data_clean %>%
  filter(year == 2019) %>%
  filter(AGE_GROUP == '60-74' | AGE_GROUP == '75 and more') %>%
  group_by(departement_code) %>%
  summarise(population_dep_old = sum(POND2))

pop_dep_now <- insee_data_clean %>%
  filter(year == 2019) %>%
  group_by(departement_code) %>%
  summarise(population_dep = sum(POND2))

pop_dep_old_now <- left_join(pop_dep_old_now, pop_dep_now, by = "departement_code") %>%
  mutate(percentage_old = population_dep_old/population_dep *100)

attendance_dep <- cnc_data_clean %>% 
  filter(year == 2019) %>%
  group_by(departement_code) %>% 
  summarise(entrées_dep = sum(entrées))

pop_dep_old_now <- left_join(pop_dep_old_now, attendance_dep, by = "departement_code")%>%
  mutate(entry_for_1000_person = (population_dep*1000)/entrées_dep)
```

```{r}
ggplot(pop_dep_old_now, aes(x = percentage_old, y = entry_for_1000_person)) +
  geom_point() +
  theme_minimal()
```


```{r}
pop_dep_etu_now <- insee_data_clean %>%
  filter(year == 2019) %>%
  filter(TYP_ACT == 3) %>%
  group_by(departement_code) %>%
  summarise(population_dep_etu = sum(POND2))

pop_dep_now <- insee_data_clean %>%
  filter(year == 2019) %>%
  group_by(departement_code) %>%
  summarise(population_dep = sum(POND2))

pop_dep_etu_now <- left_join(pop_dep_etu_now, pop_dep_now, by = "departement_code") %>%
  mutate(percentage_etu = population_dep_etu/population_dep *100)

attendance_dep <- cnc_data_clean %>% 
  filter(year == 2019) %>%
  group_by(departement_code) %>% 
  summarise(entrées_dep = sum(entrées))

pop_dep_etu_now <- left_join(pop_dep_etu_now, attendance_dep, by = "departement_code")%>%
  mutate(entry_for_1000_person = (population_dep*1000)/entrées_dep)
```

```{r}
ggplot(pop_dep_etu_now, aes(x = percentage_etu, y = entry_for_1000_person)) +
  geom_point() +
  theme_minimal()
```

# Bibliography

**BLANCHARD Jean-Philippe, 2014.** " Multiplexes, public de banlieue et création cinématographique française : caractère marchand de l'ethnicité sur grand écran ". *Migrations Société*, 151, 153-164. <https://doi.org/10.3917/migra.151.0153>

<br>

**CNC, 2008.** " Evolution du public des salles de cinéma 1993-2007 ". *Les études du CNC*

<br>

**CNC, 2013.** " L'évolution du public des salles de cinéma 1993-2012 ". *Les études du CNC*, *septembre 2013*

<br>

**CNC, 2016.** " Les publics du cinéma 1993-2015 ", *Les études du CNC, septembre 2016*

<br>

**CNC, 2020.** *Observatoire de la diffusion et de la fréquentation cinématographiques - Indicateurs permanents Année 2018*

<br>

**CRETON Laurent, 2011.** " Économie du cinéma et multiplication des supports de diffusion. Le cas français entre exemplarité et incertitude ". *Le cinéma: permanences et métamorphoses*, 180, Raison présente, 2011.

<br>

**DURAND Jacques, 1960.** " Le film et son marché " . *Esprit, Nouvelle série*, No. 285 (6), pp. 1024-1033

URL: <https://www.jstor.org/stable/24255988>

<br>

**DUVAL Julien, 2011.** " L'offre et les goûts cinématographiques en France ". *Sociologie*, 2011/1 (Vol. 2), p. 1-18. DOI : 10.3917/socio.021.0001.

URL : <https://www.cairn.info/revue-sociologie-2011-1-page-1.htm>

<br>

**HAHN Nico, 2020.** *Making Maps with R.*

URL : <https://bookdown.org/nicohahn/making_maps_with_r5/docs/introduction.html>

<br>

**MUHLBERGER David 2013.** *Cinema attendance during crises is there a relationship between cinema attendance and the state of the economy in France in the period 1992-2012?*

<br>

**SHUAI Cao, 2020.** " La politique publique du cinéma en France (1981-2012) ". *Territoires contemporains - nouvelle série \[en ligne\]*, 2 septembre 2020,

URL: <http://tristan.u-bourgogne.fr/CGC/prodscientifique/TC.html>

<br>

**TENNEKES, Martijn; NOWOSAD, Jakub; GOMBIN, Joel; JEWORUTZKI, Sebastian; RUSSELL, Kent; ZIJDEMAN, Richard; CLOUSE, John; LOVELACE, Robin; MUENCHOW, Jannes, 2023.** *Package 'tmap'*

Url: <https://cran.r-project.org/web/packages/tmap/tmap.pdf>

<br>

**THIOLLIERE Michel & RALITE Jack au nom de la Commission des affaires culturelles du Sénat, 2003.** *L'évolution du secteur de l'exploitation cinématographique, Rapport d'information sénatoriale n°308 (2002-2003)*

URL: <https://www.senat.fr/rap/r02-308/r02-308_mono.html#toc5>
