---
title: "Role of sociodemographic factors in the french cinema landscape over the last 50 years "
author: "Kylian SANTOS and Cédric BAZILE"
output:
  html_document:
    toc: TRUE
editor: visual
---

<br>

<br>

<center>

### Github link

</center>

<center><https://github.com/KylianSts/CNC_INSEE_project></center>

<br>

```{r Configuration, warning=FALSE, echo=FALSE, message=FALSE}
here::i_am("CNC_INSEE_project.Rproj")
library(here)
library(dplyr)
library(tidyr)
library(readxl)
```

# A presentation of the project

## Sources

This project is powered by two databases :

-   CNC's "**Exploitation - data by department**" : <https://www.cnc.fr/cinema/etudes-et-rapports/exploitation--donnees-par-departement_223440>

-   INSEE's "***Harmonized population census data from 1968***" : <https://www.insee.fr/fr/statistiques/6671801?sommaire=2414232>

<br>

### "***Exploitation - data by departement***"

*Original french name : "**Exploitation - données par département**"*

The first database was created by the French National Center for Cinema and the Moving Image, most commonly known as CNC. CNC is an agency of the French Ministry of Culture. Its role is to implement the state's policy on the question of cinema, audiovisual and multimedia. It is notably in charge of the regulation, promotion and distribution of french movies. The French agency also collects data regarding its purview and proposes part of them in open data.

The database "Exploitation - data by department" is one of the aforementioned open data. It is a statistical monitoring on the evolution of french cinema theater and its attendance between 1966 and 2022. It notably contains data on the number of venues, their characteristics (e.g. number of screens, seating capacity, ...); but also on the number of sold tickets and gained revenues. As its name indicates, french departments (according to their 2021 administrative division) are the statistical unit of the base. The database were constructed by using two main sources :

-   the **list of cinemas** authorized by the agency

-   and their "bordereaux des recettes" which can be roughly translated by "**revenue slips**"

<br>

### "***Harmonized population census data from 1968***"

*Original title : Données harmonisées des recensements de la population à partir de 1968*

The second database was produced by Insee, the french National Institute of Statistics and Economic Studies. Insee is French national bureau and one of its bigger data provider. The data that will be used for its project has for sources demographic information which come from the different population censuses between 1968 and 2019.

```{r Summary_of_the_last_census, echo=FALSE, message = FALSE}
list_of_census <- data.frame(census = paste0("n°", 1:8),year=c(1968,1975,1982,1990,1999,2008,2013,2019))

list_of_census<- list_of_census |>  pivot_wider(names_from="census",values_from = "year")

list_of_census |> knitr::kable(caption ="French census between 1968 and 2019", format="html", align='c')
```

Censuses are one of the most important data collections taking place in France. Answering their survey is an obligation for all inhabitants under penalty of a fine (article 3 of the Law n°51-711 of 7 June 1951). Historically, population censuses took the form of an exhaustive collect of all French townships during a same year. However, the collection method evolved in 2002. Nowadays, Insee uses a rotational approach. For townships of at least 10 000 inhabitants, 8% of the housing of are interviewed each year. The goal is then to cover 40% of their population over a 5-year period. This 5-year moving sample is then used to estimate demographic data annually. For townships withless of 10 000 inhabitants, the collection is still exhaustive but is not simultaneous. Indeed, it occurs in a fifth of towns each year ensuring that all townships are censused every 5 years. Demographic information between 2 collection is then estimated using data from the nearest one.

The data is collected by face-to-face interviews or-since 2015- via internet surveys.

The database that will be used in this project is an harmonized compilation of data from 8 census databases. Its content includes the number of inhabitant by department and key socio-demographic variables (e.g. age, socio-professional categories, type of professional activity).

It can be downloaded from the [INSEE website](https://www.insee.fr/fr/statistiques/6671801?sommaire=2414232) in a DBF or CSV format.

<br>

### Modification of the original databases

#### Formatting and cleaning the Insee database

The two databases underwent transformation to be exploitable for our project. The main problem of the Insee one is that it consumes a lot of RAM because of its size (3GB). Indeed some categorical variables have an important number of "categories"/"levels". For example, the variable on the age of the population contains 120 levels, one by each possible year of life of an individual. The result is that the number of potential combinations, and therefore of rows, among all variables is impressively large contributing to the important size of the database.

```{r Computation_of_the_number_of_rows_in_Insee_cleanv3, echo=FALSE, message = FALSE}

insee_data <- read.csv("Data/INSEE_cleanv3.csv")

insee_data <- insee_data %>% select(-X) #we drop X, the column which is an index of each row

In_nrow <- insee_data |> nrow()
```

Our work was to reduce the number of these combinations in order to downsize the database. To do so, we transform the 120 levels of the variable corresponding to the age into 5 age ranges. Furthermore, we get rid of the variables that were not useful to our project using a group_by function. It allows us to go from a database of more than 50 millions of rows to a CSV of `r In_nrow` rows.

The process that we used is detailed in the quarto document entitled "Parallel_code_Insee" that is available in this R project. We ha ve preferred to put it in a separate QMD because of the important size of the database linked with its code.

#### Formatting and cleaning the CNC database

<<<<<<< HEAD
<br>

#### Formating and cleaning of the CNC database
=======
The CNC's data was less memory-consuming. However its format was not convenient for coding with R. Indeed, the original XSLX document put each variable in an independent sheet. In the codes below, we merge all this independent sheets into one uniform database.
>>>>>>> 68857efd1cddd3db45cfb20c319dabfbbcea5229

```{r Cleaning_formating_function, message = FALSE}
file_path <- "Data/exploitation_données_par_département.xlsx"

# Function to read and process a sheet
read_and_process_sheet <- function(sheet_index) {
  cnc_data <- read_excel(file_path, sheet = sheet_index, skip = 5) |>
    select(-2) |>
    rename(departement_code = 1) |>
    pivot_longer(cols = -departement_code, 
                 names_to = "year", 
                 values_to = excel_sheets(file_path)[sheet_index])
  
  return(cnc_data)
}
```

```{r Cleaning_CNC_database, message = FALSE}

cnc_data_merge <- read_and_process_sheet(4)

for (i in seq(from = 5, to = which(excel_sheets(file_path) == "tmofAE"))) {
  cnc_data_merge <- left_join(cnc_data_merge, read_and_process_sheet(i),
                              by = c("departement_code", "year"))
}
```

As mentioned above, the original XSLX file has multiple sheets. Each sheet is equivalent to a variable and has :

-   rows as departements

-   and columns as years.

To permit the merger between each sheets, the prime step was to rename the first column so that we make sure that each sheet shares the same name. Then the second column which is the department was dropped. It permit us to start the merger.

```{r Suppression_of_total_rows, message = FALSE}
cnc_data_clean <- cnc_data_merge |>
  filter(!is.na(departement_code))
```

Each sheet has a row which represents the total. We preferred to drop it in order to simplify next statistics treatment.

```{r replace_NA_by_0_multiplexes, message = FALSE}

multiplexes_with_0 <- cnc_data_clean |> 
  select(multiplexes, year, departement_code) |> 
  pivot_wider(names_from = year, values_from = multiplexes) |> 
  mutate(across(where(~any(!is.na(.))), ~ifelse(is.na(.), 0, .))) |> 
  pivot_longer(cols = -departement_code, names_to = "year", values_to = "multiplexes")

cnc_data_clean <- cnc_data_clean |> select(-multiplexes) 
  
cnc_data_clean <- left_join(cnc_data_clean, multiplexes_with_0, by = c("departement_code", "year"))
```

In the original "Multiplexes" sheet, NA value were assigned when there were 0 multiplexes. We replaced this NA value with 0. and ensured that this replacement only occurs for the year when data had been collected

```{r}
rme <- cnc_data_clean |> select(RME)
rmeAE <- cnc_data_clean |> select(RMEAE)
tmof <- cnc_data_clean |> select(`taux d'occupation des fauteuils`)
tmofAE <- cnc_data_clean |> select(tmofAE)

cnc_data_clean <- cnc_data_clean |> select(-`indice de fréquentation`, 
                                           -`indice de fréquentationAE`, 
                                           -RME, 
                                           -RMEAE,
                                           -`taux d'occupation des fauteuils`,
                                           -tmofAE)
```

We exclude redundant variables from the final, cleaned database and retain them in separate variables. This ensures that the excluded variables are preserved for future reference, eliminating the need to recalculate them later on.

<br>

### Description of the final bases before merging

The final result is two modified datasets.

**cnc_data_clean**

```{r}
cnc_data_clean %>%
  summarize( "Number of rows" = prettyNum(nrow(.), big.mark = " "),  "Number of columns" = ncol(.)) %>%
  knitr::kable(caption = "Description of the CNC database", format = "html", align = 'c')
```

```{r}
cnc_data_clean %>% 
  group_by(year) %>% 
  summarize(
    across(where(is.numeric),list(
      Mean = ~prettyNum(mean(., na.rm = TRUE), big.mark = " "),
      Median = ~prettyNum(median(., na.rm = TRUE), big.mark = " ")
    ))
    ) %>% 
  t() %>%
  knitr::kable(caption = "Description of the CNC's variables", format = "markdown", align = 'c')
```

**insee_data (from Insee_cleanv3.csv)**

```{r Nb_rows_and_columns_Insee, echo=FALSE}
insee_data %>%
  summarize(
    "Number of rows" = prettyNum(nrow(.), big.mark = " "),
    "Number of columns" = ncol(.)
    )%>%
 knitr::kable(caption = "Description of the Insee database", format = "html", align='c')
```

```{r}
insee_data %>%
  select(-X, -POND2) %>%
  summarize(across(everything(),n_distinct)) %>% 
  t() %>% 
  knitr::kable(caption = "Number of unique values by variable", format = "html", align = 'c')
```

<br>

#### Description of the variables

We have in the CNC database different variables :

-   "**établissement**" represents the **number of movie theaters** for each department
-   "**écrans**" represents the **number of screens,** i.e. movie rooms for each department
-   "**fauteuils**" represents the total **number of seats** in all movie theaters for each department
-   "**multiplexes**" represents the **number of** **multiplexes** for each department . A multiplex is a movie theater complex with multiple screens within a single complex.
-   "**séances**" represents the total **number of seances [in thousand]{.underline}** for each department
-   "**entrées**" represents the total **number of tickets bought [in million]{.underline}** for each department
-   "**recettes**" represents the **total** **revenue in million** for each department
-   "**RME**" represents the **average revenue by bought tickets**
-   "**Taux d'occupation des fauteuils**" is the ratio between **entries during the year and the product between the number of chairs and the number of sessions**. Taux d'occupation des fauteuils makes it possible to assess the [**"fullness" of the rooms.**]{.underline}

And we have the same for Arthouse. the term Arthouse refers to so-called auteur films, economically independent, with small budgets, open to the different cultures of the world. An Arthouse cinema is a cinematographic establishment which exhibits a significant proportion of recommended Arthouse films and which supports these often difficult films with an adapted animation policy.

Insee database is a sociodemographic description of each department with variables such as :

-   "**DEP_RES_21**" represents the **department of residence where individuals live**
-   "**AGE_GROUP**" is our computed data representing the **age of the population by range of 15 years**.
-   "**TYP_ACT**" give us the **type of activity** .
-   "**CSP**" is a categorial data that has for levels **socio-professional category**
-   "**POND2**" gives us **the number of** **inhabitants** a**ccording the combination of all previous variables**

<br>

#### Merging the INSEE and CNC database

```{r insee_database}
insee_data <- insee_data |> rename(departement_code = DEP_RES_21, year =  AN_RECENS)

insee_data_clean <- insee_data |> filter(!is.na(AGE_GROUP))
```

```{r merging}
cnc_data_clean$year <- as.integer(cnc_data_clean$year) 

data_merge <- left_join(cnc_data_clean, insee_data, by = c("departement_code", "year"))

data_clean <- data_merge |>
  filter(!is.na(POND2))
```

<br>

## Research question

The central inquiry driving our investigation is as follows: **"How has the cinematic landscape in France evolved over the past five decades, and what role have sociodemographic factors played in shaping these transformations?"**

Our study is poised to delve into this question with a myriad of variables at our disposal, collectively weaving a rich tapestry of insights. The research question gains significance through the exploration of the following key aspects:

**Demographic Dynamics and Cinematic Choices:** The inclusion of variables from the INSEE database, such as department of residence (DEP_RES_21), age groups (AGE_GROUP), and socio-professional categories (CSP), enables us to discern correlations between demographic shifts and the cinematic preferences of distinct population segments. This facet unveils how societal changes influence and are influenced by the cinematic landscape.

**Economic Health of the Industry:** Variables such as the number of tickets bought (entrées), total revenue (recettes), and average revenue per bought ticket (RME) serve as pivotal metrics for gauging the economic vitality of the cinema industry. Understanding these economic aspects is crucial for deciphering the financial sustainability and success of the film sector.

**Cultural Diversity through Arthouse Cinemas:** The representation of Arthouse cinemas in our dataset unveils the emergence of a distinctive cultural niche. Examining the growth and audience engagement of these cinemas provides valuable insights into the demand for culturally diverse and intellectually stimulating cinematic content.

**Structural Shifts with Multiplexes:** The variable "multiplexes" signifies a structural transformation in how cinemas are conceived and experienced. Investigating the ascendancy and impact of multiplexes sheds light on societal preferences, emphasizing convenience and a simultaneous offering of diverse films.

**Societal Interaction through Occupancy Rates:** The occupancy rate of seats (Taux d'occupation des fauteuils) stands as a unique metric that extends beyond mere film popularity. It mirrors societal dynamics associated with communal entertainment experiences. This metric unveils the social aspects of cinema-going, providing a holistic perspective that goes beyond conventional economic indicators.

In essence, our exploration is poised to uncover the intricate interplay between cinematic evolution and sociodemographic factors, shedding light on the multifaceted nature of this dynamic relationship over the past 50 years in France.
